<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <!-- <script src='./src/car.js'></script> -->
</head>
<style>
  #car-id {
    width: 100px;
    height: 100px;
  }

  img {
    width: 100%;
  }

  #car-id {
    /* transition: .3s linear; */
    position: absolute;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
    transform: rotate(0);
  }

  .left {
    transform: rotate(-90deg);
  }

  .right {
    transform: rotate(90deg);
  }
</style>

<body>
  <div id='car-id'>
    <img src="https://img.kaikeba.com/a/05703013301202bwoe.jpg" alt="">
  </div>
</body>

<script>
  class Car {
    constructor(position, direction, step) {
      this.position = position;
      this.direction = direction;
      this.step = step;
      this.map = {
        ["N"]: {
          left: "W",
          right: "E"
        },
        ["S"]: {
          left: "E",
          right: "W"
        },
        ["W"]: {
          left: "S",
          right: "N"
        },
        ["E"]: {
          left: "N",
          right: "S"
        },
      }
    }
    getState() {
      return {
        x: this.position.x,
        y: this.position.y,
        direction: this.direction
      }
    }
    turnLeft() {
      return this.direction = this.map[this.direction].left;
    }
    turnRight() {
      return this.direction = this.map[this.direction].right;
    }
    move(map) {
      const key = map[this.direction].position;
      this.position[key] = this.position[key] += map[this.direction].step;
    }
    forward() {
      // north -> y +1
      // west -> x -1
      //East -> x +1
      //South -> y -1
      let map = {
        ["N"]: {
          position: "y",
          step: this.step
        },
        ["W"]: {
          position: "x",
          step: -this.step
        },
        ["E"]: {
          position: "x",
          step: this.step
        },
        ["S"]: {
          position: "y",
          step: -this.step
        }
      }
      this.move(map);
    }
    back() {
      //与前进相反
      let map = {
        ["N"]: {
          position: "y",
          step: -this.step
        },
        ["W"]: {
          position: "x",
          step: this.step
        },
        ["E"]: {
          position: "x",
          step: -this.step
        },
        ["S"]: {
          position: "y",
          step: this.step
        }
      }
      this.move(map)
    }
  }
  // direction N S W E 
  var carDom = document.querySelector('#car-id');
  const car = new Car({ x: 0, y: 0 }, "N", 10);

  function changeCar(x, y) {
    let dir = {
      ["N"]: 0,
      ["W"]: 270,
      ["E"]: 90,
      ["S"]: 180
    }

    carDom.style.transform = `rotate(${dir[car.direction]}deg)`
    carDom.style.left = x + 'px'
    carDom.style.top = y + 'px'
  }

  document.addEventListener('keydown', (e) => {
    switch (e.keyCode) {
      case 87:
        if (car.direction === "N" || car.direction === "S") {
          car.back();
        } else {
          car.forward();
        }
        changeCar(car.position.x, car.position.y)
        break;
      case 38:
        if (car.direction === "N" || car.direction === "S") {
          car.back();
        } else {
          car.forward();
        }
        changeCar(car.position.x, car.position.y)
        break;
      case 65:
        car.turnLeft();
        car.forward();
        changeCar(car.position.x, car.position.y)
        break;
      case 37:
        car.turnLeft();
        car.forward();
        changeCar(car.position.x, car.position.y)
        break;
      case 83:
        if (car.direction === "N" || car.direction === "S") {
          car.forward();
        } else {
          car.back();
        }
        changeCar(car.position.x, car.position.y)
        break;
      case 40:
        if (car.direction === "N" || car.direction === "S") {
          car.forward();
        } else {
          car.back();
        }
        changeCar(car.position.x, car.position.y)
        break;
      case 68:
        car.turnRight();
        car.forward();
        changeCar(car.position.x, car.position.y)
        break;
      case 39:
        car.turnRight();
        car.forward();
        changeCar(car.position.x, car.position.y)
        break;
    }
  })
</script>

</html>